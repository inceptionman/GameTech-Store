{% extends "base.html" %}

{% block title %}Solicitar Factura - GameTech Store{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-file-invoice me-2"></i>Solicitar Factura
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Informaci√≥n de la orden -->
                    <div class="alert alert-info">
                        <h5><i class="fas fa-shopping-bag me-2"></i>Orden #{{ order.id }}</h5>
                        <p class="mb-1"><strong>Fecha:</strong> {{ order.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                        <p class="mb-0"><strong>Total:</strong> ${{ "%.2f"|format(order.total) }}</p>
                    </div>

                    <form method="POST" action="{{ url_for('invoice.solicitar_factura', order_id=order.id) }}">
                        <h5 class="mb-3">Datos Fiscales (Colombia)</h5>
                        
                        <div class="row">
                            <!-- Tipo de Documento -->
                            <div class="col-md-4 mb-3">
                                <label for="tipo_documento" class="form-label">Tipo de Documento <span class="text-danger">*</span></label>
                                <select class="form-select" id="tipo_documento" name="tipo_documento" required>
                                    <option value="13">C√©dula de Ciudadan√≠a</option>
                                    <option value="31" selected>NIT</option>
                                    <option value="22">C√©dula de Extranjer√≠a</option>
                                    <option value="41">Pasaporte</option>
                                </select>
                            </div>
                            
                            <!-- NIT/CC -->
                            <div class="col-md-8 mb-3">
                                <label for="nit" class="form-label">NIT / C√©dula <span class="text-danger">*</span></label>
                                <input type="text" 
                                       class="form-control" 
                                       id="nit" 
                                       name="nit" 
                                       value="{{ user.rfc or '' }}"
                                       maxlength="20"
                                       required
                                       placeholder="900123456-7">
                                <small class="text-muted">Incluir d√≠gito de verificaci√≥n si es NIT</small>
                            </div>
                        </div>

                        <!-- Raz√≥n Social -->
                        <div class="mb-3">
                            <label for="razon_social" class="form-label">Raz√≥n Social <span class="text-danger">*</span></label>
                            <input type="text" 
                                   class="form-control" 
                                   id="razon_social" 
                                   name="razon_social" 
                                   value="{{ user.razon_social or '' }}"
                                   required
                                   placeholder="Nombre o Raz√≥n Social">
                        </div>

                        <!-- Direcci√≥n Fiscal -->
                        <div class="mb-3">
                            <label for="direccion_fiscal" class="form-label">Direcci√≥n Fiscal</label>
                            <textarea class="form-control" 
                                      id="direccion_fiscal" 
                                      name="direccion_fiscal" 
                                      rows="2"
                                      placeholder="Calle, N√∫mero, Colonia, Ciudad, Estado">{{ user.direccion_fiscal or '' }}</textarea>
                        </div>

                        <div class="row">
                            <!-- Ciudad -->
                            <div class="col-md-6 mb-3">
                                <label for="ciudad" class="form-label">Ciudad</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="ciudad" 
                                       name="ciudad" 
                                       placeholder="Bogot√°">
                            </div>

                            <!-- Departamento -->
                            <div class="col-md-6 mb-3">
                                <label for="departamento" class="form-label">Departamento</label>
                                <select class="form-select" id="departamento" name="departamento">
                                    <option value="">Seleccionar...</option>
                                    <option value="Amazonas">Amazonas</option>
                                    <option value="Antioquia">Antioquia</option>
                                    <option value="Arauca">Arauca</option>
                                    <option value="Atl√°ntico">Atl√°ntico</option>
                                    <option value="Bogot√° D.C." selected>Bogot√° D.C.</option>
                                    <option value="Bol√≠var">Bol√≠var</option>
                                    <option value="Boyac√°">Boyac√°</option>
                                    <option value="Caldas">Caldas</option>
                                    <option value="Caquet√°">Caquet√°</option>
                                    <option value="Casanare">Casanare</option>
                                    <option value="Cauca">Cauca</option>
                                    <option value="Cesar">Cesar</option>
                                    <option value="Choc√≥">Choc√≥</option>
                                    <option value="C√≥rdoba">C√≥rdoba</option>
                                    <option value="Cundinamarca">Cundinamarca</option>
                                    <option value="Guain√≠a">Guain√≠a</option>
                                    <option value="Guaviare">Guaviare</option>
                                    <option value="Huila">Huila</option>
                                    <option value="La Guajira">La Guajira</option>
                                    <option value="Magdalena">Magdalena</option>
                                    <option value="Meta">Meta</option>
                                    <option value="Nari√±o">Nari√±o</option>
                                    <option value="Norte de Santander">Norte de Santander</option>
                                    <option value="Putumayo">Putumayo</option>
                                    <option value="Quind√≠o">Quind√≠o</option>
                                    <option value="Risaralda">Risaralda</option>
                                    <option value="San Andr√©s y Providencia">San Andr√©s y Providencia</option>
                                    <option value="Santander">Santander</option>
                                    <option value="Sucre">Sucre</option>
                                    <option value="Tolima">Tolima</option>
                                    <option value="Valle del Cauca">Valle del Cauca</option>
                                    <option value="Vaup√©s">Vaup√©s</option>
                                    <option value="Vichada">Vichada</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- C√≥digo Postal -->
                            <div class="col-md-6 mb-3">
                                <label for="codigo_postal" class="form-label">C√≥digo Postal</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="codigo_postal" 
                                       name="codigo_postal" 
                                       value="{{ user.codigo_postal or '' }}"
                                       maxlength="6"
                                       placeholder="110111">
                            </div>
                            
                            <!-- Tel√©fono -->
                            <div class="col-md-6 mb-3">
                                <label for="telefono" class="form-label">Tel√©fono</label>
                                <input type="tel" 
                                       class="form-control" 
                                       id="telefono" 
                                       name="telefono" 
                                       placeholder="3001234567">
                            </div>
                        </div>

                        <!-- Forma de Pago -->
                        <div class="mb-3">
                            <label for="forma_pago" class="form-label">Forma de Pago</label>
                            <select class="form-select" id="forma_pago" name="forma_pago">
                                <option value="Efectivo">Efectivo</option>
                                <option value="Tarjeta de Cr√©dito" selected>Tarjeta de Cr√©dito</option>
                                <option value="Tarjeta de D√©bito">Tarjeta de D√©bito</option>
                                <option value="Transferencia Bancaria">Transferencia Bancaria</option>
                                <option value="PSE">PSE</option>
                                <option value="Nequi">Nequi</option>
                                <option value="Daviplata">Daviplata</option>
                            </select>
                        </div>
                        
                        <!-- Email (autom√°tico) -->
                        <div class="alert alert-info">
                            <i class="fas fa-envelope me-2"></i>
                            <strong>Email:</strong> {{ user.email }}
                            <br>
                            <small>La factura ser√° enviada autom√°ticamente a este correo</small>
                        </div>

                        <!-- Guardar datos -->
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="guardar_datos" name="guardar_datos" checked>
                            <label class="form-check-label" for="guardar_datos">
                                Guardar estos datos para futuras facturas
                            </label>
                        </div>

                        <hr>

                        <!-- Resumen -->
                        <div class="alert alert-light">
                            <h6>Resumen de Factura:</h6>
                            <p class="mb-1">Subtotal: ${{ "%.2f"|format(order.total / 1.19) }} COP</p>
                            <p class="mb-1">IVA (19%): ${{ "%.2f"|format(order.total - (order.total / 1.19)) }} COP</p>
                            <p class="mb-0"><strong>Total: ${{ "%.2f"|format(order.total) }} COP</strong></p>
                        </div>

                        <!-- Botones -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('cart.mis_ordenes') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-file-invoice me-2"></i>Generar Factura
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Informaci√≥n adicional -->
            <div class="card shadow mt-3">
                <div class="card-body">
                    <h6><i class="fas fa-info-circle me-2 text-info"></i>Informaci√≥n Importante</h6>
                    <ul class="small mb-0">
                        <li>La factura electr√≥nica se generar√° inmediatamente</li>
                        <li>üìß <strong>Recibir√°s la factura por correo electr√≥nico</strong> en formato PDF</li>
                        <li>La factura es v√°lida ante la DIAN</li>
                        <li>Podr√°s descargarla desde tu perfil en cualquier momento</li>
                        <li>Los datos fiscales deben ser correctos</li>
                        <li>IVA del 19% aplicado seg√∫n normativa colombiana</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
